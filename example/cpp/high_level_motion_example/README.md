# 机器人摇杆控制示例

这是一个使用Magic Robot SDK控制机器人移动的示例程序，通过键盘输入模拟摇杆控制。

## 功能特性

- **实时摇杆控制**: 通过键盘按键模拟摇杆输入，控制机器人移动
- **安全控制**: 包含紧急停止和安全关闭机制
- **状态监控**: 实时显示摇杆状态和机器人连接状态
- **错误处理**: 完善的错误处理和状态检查
- **用户友好**: 清晰的控制说明和状态提示

## 控制说明

### 左侧摇杆控制（移动）
- `W` - 前进 (left_y + 0.1)
- `X` - 后退 (left_y - 0.1)
- `A` - 左转 (left_x - 0.1)
- `F` - 右转 (left_x + 0.1)

### 右侧摇杆控制（旋转）
- `Q` - 左旋转 (right_x - 0.1)
- `E` - 右旋转 (right_x + 0.1)
- `R` - 上倾 (right_y + 0.1)
- `C` - 下倾 (right_y - 0.1)

### 其他控制
- `S` - 停止并退出程序
- `Z` - 重置摇杆到中心位置
- `Ctrl+C` - 紧急停止

## 摇杆值范围

- 所有摇杆轴的值范围：[-1.0, 1.0]
- 增量步长：0.1
- 控制频率：20Hz (50ms周期)

## 程序流程

1. **初始化**: 初始化SDK和机器人连接
2. **设置控制模式**: 切换到高层运动控制器
3. **设置步态**: 先设置为站立恢复步态，再切换到移动步态
4. **控制循环**: 持续发送摇杆命令
5. **安全关闭**: 停止移动，恢复站立步态，断开连接

## 编译和运行

### 编译
```bash
# 在项目根目录下
mkdir -p build && cd build
cmake ..
make
```

### 运行
```bash
# 在build目录下
./example/high_level_motion_example/joy_control_example
```

或者直接运行：
```bash
cd example/high_level_motion_example
./joy_control_example
```

## 配置说明

### IP地址配置
程序中的机器人IP地址设置为 `192.168.55.10`，请根据实际网络环境修改：

```cpp
std::string local_ip = "192.168.55.10";
```

### 控制参数
可以在程序开头修改以下常量来调整控制行为：

```cpp
constexpr double JOY_STEP = 0.1;           // 摇杆增量步长
constexpr int CONTROL_FREQ_HZ = 20;        // 控制频率20Hz
constexpr int CONTROL_PERIOD_MS = 50;      // 控制周期50ms
constexpr int RPC_TIMEOUT_MS = 5000;       // RPC超时时间5秒
```

## 安全注意事项

1. **确保机器人处于安全环境**: 运行前请确保机器人周围有足够的空间
2. **保持紧急停止可用**: 随时准备按 `Ctrl+C` 或 `S` 键停止程序
3. **检查网络连接**: 确保与机器人的网络连接稳定
4. **监控机器人状态**: 注意观察机器人的实际运动状态

## 错误处理

程序包含完善的错误处理机制：

- **连接失败**: 自动重试并显示详细错误信息
- **命令发送失败**: 记录错误并尝试继续运行
- **步态切换失败**: 显示错误信息并安全退出
- **信号中断**: 安全关闭机器人并清理资源

## 技术细节

### 线程安全
- 使用 `std::atomic` 确保摇杆值的线程安全访问
- 键盘输入和控制循环运行在不同线程中

### 状态管理
- 使用状态机管理机器人的不同工作状态
- 确保步态切换的正确顺序

### 资源管理
- 使用RAII原则管理资源
- 确保程序退出时正确清理所有资源

## 故障排除

### 常见问题

1. **连接失败**
   - 检查网络连接
   - 确认IP地址正确
   - 检查防火墙设置

2. **控制无响应**
   - 确认机器人处于正确的步态模式
   - 检查控制频率设置
   - 查看错误日志

3. **程序异常退出**
   - 检查信号处理器设置
   - 确认资源清理正确
   - 查看系统日志

### 调试模式
可以通过修改日志级别来获取更详细的调试信息。

## 扩展功能

可以考虑添加以下功能：

- **配置文件支持**: 从文件读取控制参数
- **GUI界面**: 添加图形化控制界面
- **记录功能**: 记录控制命令和机器人状态
- **自动控制**: 添加预设动作序列
- **传感器反馈**: 集成传感器数据进行闭环控制 