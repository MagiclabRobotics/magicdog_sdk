---
title: 状态监控服务
createTime: 2025/05/29 10:18:56
permalink: /dog/monitor_reference/
---

# MagicDog SDK C++ API - 状态监控服务

> 提供机器人状态监控接口类，通过 StateMonitor 可以实现状态查询等功能。

## 接口定义
<code>StateMonitor</code> 是机器人系统状态监控管理类，该类通常用于控制机器人的状态管理，支持状态查询。

### GetCurrentState
<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 40%; text-align: center;"><strong>项目</strong></th>
      <th style="width: 60%; text-align: center;"><strong>内容</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr><td>函数名</td><td>GetCurrentState</td></tr>
    <tr><td>函数声明</td><td><code>RobotState GetCurrentState();</code></td></tr>
    <tr><td>功能概述</td><td>获取当前机器人聚合状态。</td></tr>
    <tr><td>参数说明</td><td><code>robot_state</code>：用于接收状态结构体。</td></tr>
    <tr><td>返回值</td><td><code>RobotState</code> 对象。</td></tr>
    <tr><td>备注</td><td>非阻塞接口，获取最近监控到的机器人状态数据，包括 BMS 电池状态、故障信息等，后续会持续扩展。</td></tr>
  </tbody>
</table>

### <code>RobotState</code> — 机器人状态数据结构体

用于表示机器人总体状态信息：

<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 40%; text-align: center;"><strong>字段名</strong></th>
      <th style="width: 20%; text-align: center;"><strong>类型</strong></th>
      <th style="width: 40%; text-align: center;"><strong>描述</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr><td><code>faults</code></td><td><code>std::vector&lt;Fault&gt;</code></td><td>故障信息列表</td></tr>
    <tr><td><code>bms_data</code></td><td><code>BmsData</code></td><td>电池管理系统数据</td></tr>
  </tbody>
</table>

### <code>BmsData</code> — 电池管理系统数据结构体

表示电池的状态信息：

<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 40%; text-align: center;"><strong>字段名</strong></th>
      <th style="width: 20%; text-align: center;"><strong>类型</strong></th>
      <th style="width: 40%; text-align: center;"><strong>描述</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr><td><code>battery_percentage</code></td><td><code>float</code></td><td>当前电池剩余电量（百分比，0~100）</td></tr>
    <tr><td><code>battery_health</code></td><td><code>float</code></td><td>电池健康状态（数值越高表示健康状态越好）</td></tr>
    <tr><td><code>battery_state</code></td><td><code>BatteryState</code></td><td>电池状态（见上方枚举）</td></tr>
    <tr><td><code>power_supply_status</code></td><td><code>PowerSupplyStatus</code></td><td>电池充放电状态（见上方枚举）</td></tr>
  </tbody>
</table>

### 枚举类型定义

#### <code>BatteryState</code> — 电池状态枚举类型

用于表示电池当前的状态，用于系统中电池状态的判断和处理：

<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 40%; text-align: center;"><strong>枚举值</strong></th>
      <th style="width: 20%; text-align: center;"><strong>数值</strong></th>
      <th style="width: 40%; text-align: center;"><strong>描述</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr><td><code>BatteryState::UNKNOWN</code></td><td>0</td><td>未知状态</td></tr>
    <tr><td><code>BatteryState::GOOD</code></td><td>1</td><td>电池状态良好</td></tr>
    <tr><td><code>BatteryState::OVERHEAT</code></td><td>2</td><td>电池过热</td></tr>
    <tr><td><code>BatteryState::DEAD</code></td><td>3</td><td>电池损坏</td></tr>
    <tr><td><code>BatteryState::OVERVOLTAGE</code></td><td>4</td><td>电池过电压</td></tr>
    <tr><td><code>BatteryState::UNSPEC_FAILURE</code></td><td>5</td><td>未知故障</td></tr>
    <tr><td><code>BatteryState::COLD</code></td><td>6</td><td>电池过冷</td></tr>
    <tr><td><code>BatteryState::WATCHDOG_TIMER_EXPIRE</code></td><td>7</td><td>看门狗定时器超时</td></tr>
    <tr><td><code>BatteryState::SAFETY_TIMER_EXPIRE</code></td><td>8</td><td>安全定时器超时</td></tr>
  </tbody>
</table>

#### <code>PowerSupplyStatus</code> — 电池充放电状态

用于表示当前电池的充放电状态：

<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 40%; text-align: center;"><strong>枚举值</strong></th>
      <th style="width: 20%; text-align: center;"><strong>数值</strong></th>
      <th style="width: 40%; text-align: center;"><strong>描述</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr><td><code>PowerSupplyStatus::UNKNOWN</code></td><td>0</td><td>未知状态</td></tr>
    <tr><td><code>PowerSupplyStatus::CHARGING</code></td><td>1</td><td>电池充电中</td></tr>
    <tr><td><code>PowerSupplyStatus::DISCHARGING</code></td><td>2</td><td>电池放电中</td></tr>
    <tr><td><code>PowerSupplyStatus::NOTCHARGING</code></td><td>3</td><td>电池未充放电</td></tr>
    <tr><td><code>PowerSupplyStatus::FULL</code></td><td>4</td><td>电池充满</td></tr>
  </tbody>
</table>

## 错误码映射表

<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 40%; text-align: center;"><strong>错误码（十六进制）</strong></th>
      <th style="width: 60%; text-align: center;"><strong>错误描述</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr><td>0x0000</td><td>无错误</td></tr>
    <tr><td>0x1101</td><td>调用 ROS 服务失败</td></tr>
    <tr><td>0x1301</td><td>中控节点丢失</td></tr>
    <tr><td>0x1302</td><td>APP 节点丢失</td></tr>
    <tr><td>0x1304</td><td>音频节点丢失</td></tr>
    <tr><td>0x1305</td><td>运动节点丢失</td></tr>
    <tr><td>0x1306</td><td>LCD 节点丢失</td></tr>
    <tr><td>0x1307</td><td>realsense 节点丢失</td></tr>
    <tr><td>0x1308</td><td>双目相机节点丢失</td></tr>
    <tr><td>0x1309</td><td>LDS 节点丢失</td></tr>
    <tr><td>0x130A</td><td>传感器板节点丢失</td></tr>
    <tr><td>0x130B</td><td>触摸节点丢失</td></tr>
    <tr><td>0x130C</td><td>SLAM 节点丢失</td></tr>
    <tr><td>0x130D</td><td>导航节点丢失</td></tr>
    <tr><td>0x130E</td><td>AI 节点丢失</td></tr>
    <tr><td>0x130F</td><td>头部节点丢失</td></tr>
    <tr><td>0x1310</td><td>云端处理器节点丢失</td></tr>
    <tr><td>0x3201</td><td>激光无数据</td></tr>
    <tr><td>0x3202</td><td>双目相机无数据</td></tr>
    <tr><td>0x3203</td><td>双目相机数据错误</td></tr>
    <tr><td>0x3204</td><td>双目相机初始化失败</td></tr>
    <tr><td>0x320B</td><td>里程计无数据</td></tr>
    <tr><td>0x320C</td><td>IMU 无数据</td></tr>
    <tr><td>0x6101</td><td>机器人连接 APP 失败</td></tr>
    <tr><td>0x6102</td><td>与 APP 断开连接</td></tr>
    <tr><td>0x9201</td><td>打开 LCD 串口失败</td></tr>
    <tr><td>0x7201</td><td>打开头部串口失败</td></tr>
    <tr><td>0x7202</td><td>头部无数据</td></tr>
    <tr><td>0x8201</td><td>打开传感器板串口失败</td></tr>
    <tr><td>0x8202</td><td>传感器板无数据</td></tr>
    <tr><td>0x2201</td><td>错误：导航未收到 tf 数据</td></tr>
    <tr><td>0x2202</td><td>错误：导航未收到地图数据</td></tr>
    <tr><td>0x2203</td><td>错误：导航未收到定位数据</td></tr>
    <tr><td>0x2204</td><td>错误：导航未收到超声波数据</td></tr>
    <tr><td>0x2205</td><td>错误：导航未收到激光数据</td></tr>
    <tr><td>0x2206</td><td>错误：导航未收到 RGBD 数据</td></tr>
    <tr><td>0x2207</td><td>错误：导航未收到多线激光数据</td></tr>
    <tr><td>0x2208</td><td>错误：导航未收到点 TOF 数据</td></tr>
    <tr><td>0x2209</td><td>错误：导航未收到面 TOF 数据</td></tr>
    <tr><td>0x220A</td><td>错误：导航未收到里程计数据</td></tr>
    <tr><td>0x2101</td><td>警告：导航未收到 tf 数据</td></tr>
    <tr><td>0x2102</td><td>警告：导航未收到地图数据</td></tr>
    <tr><td>0x2103</td><td>警告：导航未收到定位数据</td></tr>
    <tr><td>0x2104</td><td>警告：导航未收到超声波数据</td></tr>
    <tr><td>0x2105</td><td>警告：导航未收到激光数据</td></tr>
    <tr><td>0x2106</td><td>警告：导航未收到 RGBD TOF 数据</td></tr>
    <tr><td>0x2107</td><td>警告：导航未收到多线激光数据</td></tr>
    <tr><td>0x2108</td><td>警告：导航未收到点 TOF 数据</td></tr>
    <tr><td>0x2109</td><td>警告：导航未收到面 TOF 数据</td></tr>
    <tr><td>0x210A</td><td>警告：导航未收到里程计数据</td></tr>
    <tr><td>0x4201</td><td>SLAM 定位错误</td></tr>
    <tr><td>0x4102</td><td>错误：SLAM 未收到激光数据</td></tr>
    <tr><td>0x4103</td><td>错误：SLAM 未收到里程计数据</td></tr>
    <tr><td>0x4205</td><td>SLAM 地图错误</td></tr>
  </tbody>
</table>

